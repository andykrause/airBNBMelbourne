---
title: "Should I Airbnb My Property?"
author: "Andy Krause and Gideon Aschwanden"
date: "February 17, 2017"
output:
  pdf_document: default
  html_document: default
header-includes: \usepackage{setspace}\doublespacing
geometry: margin=3.3cm
bibliography: abb.bib
---

```{r load_libraries, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE, results='hide'}

  library(spdep)
  library(maptools)
  library(gstat)
  library(ggplot2)
  library(geosphere)
  library(ggmap)
  library(xtable)
  library(chron)
  library(plyr)
  library(sp)
  library(rgeos)
  library(reshape2)
  library(stringr)
  library(RColorBrewer)
  library(Hmisc)
  library(kernlab)
  library(lmtest)
  library(ROCR)

```

```{r set_paths, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE, results='hide'}

  # Get computer names

  comp.name <- Sys.info()['nodename']

  # Assign path based on computer name
  
  if(comp.name == '7020D-121777-W' | comp.name == 'DESKTOP-1D7JO4J'){
  
    data.path <- 'c:/dropbox/research/airBNB/data/'
    code.path <- 'c:/code/'
    fig.path <- 'c:/dropbox/research/airBNB/figures/'
    
  } else {
  
    data.path <- 'alternate data path'
    code.path <- 'alternate data path'
    
  }

 ## Set options

  options(xtable.comment = FALSE)
  options(xtable.caption.placement='top')
  
```

```{r source_files, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE, results='hide'}

  source(paste0(code.path, "dataviztools/ggplottools.R"))
  source(paste0(code.path, "datamgmttools/dataMungetools.R"))
  source(paste0(code.path, "research/AirBNBMelbourne/abb_Functions.R"))

```

```{r set_colors, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE}

 # Set all colors

  abb.colors.names=c('rausch', 'hackberry', 'kazan', 'babu', 'lima', 'beach',
                     'ebisu', 'tirol', 'foggy', 'hof')
  abb.col <- c(rgb(250,88,99, maxColorValue=255), rgb(139,14,82, maxColorValue=255),
               rgb(0,117,140, maxColorValue=255), rgb(4,211,191, maxColorValue=255), 
               rgb(77,226,110, maxColorValue=255), rgb(252,179,14, maxColorValue=255),
               rgb(249,177,139, maxColorValue=255), rgb(191,166,100, maxColorValue=255),
               rgb(156,161,155, maxColorValue=255), rgb(86,94,97, maxColorValue=255))

  # Set specific colors
  
  str.col <- abb.col[1]
  ltr.col <- abb.col[3]
  
```

```{r load_workspace, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE, cache=TRUE}

   load(paste0(data.path, '/analyzed/analyzed_workspace.RData'))

```

&nbsp;
&nbsp;

## Introduction

With the rise of Airbnb and other self-hosting accommodation platforms^[Flipkey.com, VRBO.com, Homeaway.com, Tripping.com as examples.], it is easier than ever for property owners and investors to consider short-term rental (STR) as a potential use for a revenue generating residential property. Should they though? Or rather, is it more profitable to do so when compared to a more traditional long term rental (LTR)? Are certain types of properties and certain locations, if any, more likely to show a preference for (in terms of profitability) short term leasing strategy over long-term.

To address these questions and to provide some guidance to potential and current investors and owners, we examine the residential rental market, both short- and long-term in Melbourne, Australia. Melbourne has a thriving short-term rental market with over 20,000 total properties listed on the Airbnb portal, the source of our short-term market data. We adopt a scenario-based approach that compares potential annual revenues for properties under both a short-term rental (STR) and a long-term rental (LTR) situation. We break the results down by property types (apartments vs houses), product type (e.g. 1 bed/1 bath) and by location (geographic submarket).  Our results shows that the feasibility of a greater return through a short term rental -- what we have termed ``Short Term Preference'' -- is dependent on property type, product and location.  In short, the answer to whether or not a owner or investor should opt for a short-term leasing strategy: it depends.  

## Literature Review

Existing research into short-term rental markets is sparse. However, with the arrival of Airbnb, and the controversies surrounding it, the topic is creating interest both in real estate and economics as well as in a wide variety of fields as evidenced by a growth in recent publications and on-going working papers.  Within the extant work, the focus remains centered on rural and/or amenity-based STRs such as beach-front and ski-resorts.  This focus resulted from the fact that the market itself operated almost wholly within this sphere.  The shift to small, urban dwellings within the STR market is relatively new and explains the dearth of past work in this direction. 

Much of the existing work focuses on price or rent formation in second home markets.  Specifically, the impacts of amenities such as water access [@nelson2010valuing], water quality [@gibbs2002hedonic; @clapper2014water], proximity to ski facilities  [@soguel2008impact; @nelson2010valuing] and theme parks [@tsai2015impact] are shown to positively impact sales prices in tourism-dominated areas.  Host policies can also matter as @benjamin2001value find that smoking prohibitions influence the weekly rental rates for vacation homes.

Focusing specifically on the short-term rental market, @cassidy2007tourist suggest that within Australia's Gold Coast, the STR industry lacks sophistication and efficiency.  Most notably, they find that most nightly or weekly rates are set by resident unit managers (RUMs) and are often under-priced as there is little accountability toward owners.  The authors also note that very little research has been put toward understanding this growing market segment.

A set of recent work has looked into the impact of short-term markets on housing prices and affordability. These working papers examine the influence of Airbnb on existing housing prices in New York [@sheppard2016airbnb], Los Angeles [@lee2016airbnb] and Boston [@merante2016home]. Though very broad analyses, all suggest that Airbnb has had a positive impact on local home prices and/or a negative impact on affordability. Other research examines the impact of short-term rentals on the hotel market, with @gutierrez2016airbnb finding that Airbnb and hotels have similar location patterns in Barcelona and @zervas2014rise showing an inverse relationship between Airbnb listings and hotel revenues.

A critical theme that arises out of the extant literature is that fundamentals of the markets for primary dwellings (owner-occupied and long-term rentals) may differ from those of vacation homes (or, by association, short-term rentals). Or, in other words, the factors that influence prices and rents in the two are not equivalent. @cho2003impacts find that the second home market is more sensitive to proximity to environmental amenities than the owner occupied market. In Switzerland, @soguel2008impact test to see if second homes pay a higher premium for ski resort access.  Their results fail to show a statistically significant difference in the impact of ski resorts between markets, but do find that other property characteristics have heterogenous effects between the two. In examining the difference between the urban and rural STR markets,  @nilsson2015influence makes a key distinction, finding that rural vacation home markets value amenities whereas urban holiday properties tend to derive large premiums from proximity to attractive residential areas.

Though issues of second homes were primarily treated as a rural phenomenom for decades  [@gallent2007second], a wave of ``new urban tourism'' @fuller2014stop has re-focused some of the problems of short term rentals on large, urban environments. With this move to urban areas, issues such as nuisance, property rights and regulation have naturally arisen.  As a result, the short-term rental market has garnered significant interest in the public policy and legal sphere as of late. As many second homes are not permitted for or regulated as commercial entities, STRs can have serious effects on neighbors in the way of externalies such as noise and congestion [@frost2006commentary].  While strict regulation is often proposed, doing so may constititute regulatory takings [@jefferson2015can].  Other, rights-based, regulatory approaches have been suggested [@miller2014transferable].  Many of the key legal decisions regarding short term rentals, particulary though Airbnb, are still in progress and much remains to be settled in this area in terms of the regulatory and legal environment in which STRs are allowed to operate.

Overall, the extant literature on short-term rentals is limited, but growing.  Of the three types of research -- pricing, impacts on housing market and legalities/externalities -- none specifically address the decision faced by an owner who is trying to decide between a long- or short-term leasing strategy. The closest analog in the literature is a piece by @larson2009pur examining the choice between purchasing a time-share or simply paying for hotel rooms.  Theoretically, the literature shows that in most cases there is a demonstratable difference between first and second home market dynamics due to the use differences of the occupants.  We hypothesize that this same thinking can be extended to the difference between short-term rental occupants (tourists and business travelers) and long-term rental occupants (workers and retirees) and, as a result, there should be differences in the market which make certain housing products and locations preferable (more profitable) under a short-term versus long-term tenure.

## Method

We approach answering the question of whether to pursue a short- or long-term leasing strategy by creating and assessing a scenario likely to be faced by a recent purchaser of a property.  More specifically, we examine the following case:

* An investor purchases a property in Melbourne, Australia on September 1, 2015.
* They are looking to maximize the net revenue over the 12-month period from September 1, 2015 to August 31, 2016.
* The choices are 1) traditional year long rental (long term), or: 2) short-term, nightly Airbnb-type rental.
* Only direct monetary revenues and costs are considered, others such as liquidity and inconvenience are not considered.
* As most long-term rentals use a leasing agency, we will assume use of an agency. 

We will not, a priori, specify a location or property type for the scenario as we hypothesize that the preference of a short-term rental over a long-term one will vary by the location and property characteristics. The extent to which location, property type and property characteristics impact the probabilit of short-term preference are examined in the results section. 

Australia implements a particular tax policy, often termed `negative gearing', that allows for favourable tax treatment to real estate investors who experience greater costs than revenues on investment properties^[See @fane2004negative for a complete explanation of negative gearing.] To date, this policy only applies to long-term rental properties.  While this policy can influence the net revenue (post tax) of a property, the negative gearing policy requires knowledge of the investor's personal income situation.  As we do not have access to this information in the marketplace, we will not be considering any effects of this policy in our analysis here.

One benefit of a short-term rental may be the ability to adjust the nightly rate over the course of the year to reflect changing demand and market trends. As future market trends are unknown at the time of purchase and the decision of long- vs short-term leasing strategy is asymetrically irreversable (can go from short to long, but not long to short), we make our comparisons using a fixed nightly (short-term) rate to respresent the most likely state of knowledge for our hypothetical investor on September 1, 2015. Both long-term rents and short-term rates and occupancy structures will be based on the market conditions as of this date.

We do not directly observe properties that are utilized in both a short- and long-term leasing strategy. Therefore, comparisons are done based on estimated or imputed revenues. Most specifically, we will estimate the long-term revenue for observations of properties currently listed on a short-term rental portal (Airbnb). Initially, we attempted to also estimate short-term rental revenue for long-term properties but found the process of imputing occupancy rates and nightly rate structures too inaccurate to provide valid comparisons.

### Comparison

In this scenario we compare the observed 12-month revenues from short-term rental properties with their hypothetical long-term rental revenues.  We define revenue here as the gross revenue minus the direct costs associated with each of the two tenure possibilities. Costs which are equivalent between the two strategies are ignored.  

\begin{equation}
Rev_{ST} = RevG_{ST} - C_{ST}
\end{equation}

The gross short-term revenue is expressed by:

\begin{equation}
RevG_{ST} = Rate_{N} * O_{Total}
\end{equation}

where $Rate_{N}$ is the average nightly rate and $O_{Total}$ are the total number of occupancies (bookings) over the 12-month period. For long-term revenues:

\begin{equation}
Rev_{LT} = RevG_{LT} - C_{LT}
\end{equation}

Where $Rev_{LT}$ is the net revenue for a long-term rental, $RevG_{LT}$ is the gross revenue and $C_{LT}$ are the specific costs associated with long-term rental. The gross long-term revenue is expressed by:

\begin{equation}
RevG_{LT} = Rent_{M} * (12 - C_{S})
\end{equation}

where $Rent_{M}$ is the nominal monthly rent and $C_{S}$ are search costs defined in terms of the time (in months) spent to find a long-term tenant.

We have limited our consideration of costs in this case to be those undergone during a single year of ownership.  Broadly speaking, these fall into four categories long-term rental and five for short-term properties.  Long-term costs are summarized as:

\begin{equation}
C_{LT} = T + M + F + L
\end{equation}

where $T$ are tax related expenses, $M$ are general maintenance expenses, $F$ are financing costs and $L$ are leasing agency fees. Short-term properies experience three of the same costs ($T$, $M$ and $F$) plus additional janitorial costs $J$ between each of the short-term occupants as well as property utility costs, $U$ over the course of the year.

\begin{equation}
C_{ST} = T + M + F + J + U
\end{equation}

As our scenario compares a hypothetical and particular owner over the course of a single  year the tax $T$ and $F$ costs are identical between the two leasing strategy and therefore cancel out. General maintenance $M$ expenses may differ between the two strategies, and an argument could be made for either to be higher. Long-term renters spend more time in the property over the course of the year and bring their own appliances^[White goods are usually not supplied in the Australian rental market.] and furniture which may damage the home. They are also more likely to affix items to the structure.  Conversely, short-term rentals are usually furnished and the occupants have less incentive not to be evicted as their damage is not often uncovered until after they have left^[Note that Airbnb's rating policy may help protect hosts as bad guests can be flagged on the platform.].  Both arguments are meritous and we were unable to find any evidence to support maintenance costs being higher in short or long term rentals. As a result we have made the assumption that the maintenance costs will be identical, and they too cancel out.

Leasing costs $L$ are the fees paid to the rental agency to find and manage tenants over the life of the lease.  In Melbourne, rates generally range from 5\% to 7\% per annum.  We have assumed leasing costs of 6\% of the total gross revenue of the long-term lease contract. 

Janitorial costs, $J$, cover the costs to 'turn-over' the property between occupants.  For a short-term leasing strategy, these costs can be experienced every day or two, depending on the minimum length of stay and the total number of occupancies over the course of the year. Our data for short-term rentals comes from the Airbnb platform.  In addition to the nightly rate that an occupant pays to the owner there is also a separate 'cleaning fee' that is attached, as is a booking fee to Airbnb^[This fee could be considered analogous to the leasing fees $L$ that long-term rentals pay]. Some hosts add additional 'linen' fees to cover costs of laundering.  While it may be advantageous for hosts in competitive markets to underquote their cleaning fees to keep occupancies up, we have no evidence to suggest that owners are exhibiting such behavior. As a result of janitorial fees being a separate line item and directly paid by the occupants they can also be ignored in the comparative analysis below as they are direct.

Finally, there are utility costs, $U$, that are borne by the property owner in a short-term leasing strategy but by the tenant in a long-term option.  The State of Victoria estimates energy costs for an apartment at A\$330 per month and for a larger house at A\$520 per month.  For two people in an apartment the cost is approximately A\$5 per person per day and for a four person household in a detached house the cost is around A\$4 per person per day person. For the purposes of estimating utility costs for the short-term rentals we use a mid-point value of A\$4.50 per person per day.  As we don't know total number of guests in each reservation we use a figure of 1.7 guests per bedroom and sum up the total costs for all bookings over the year.   

\begin{equation}
U = (4.5 * B * 1.7) * O
\end{equation}

We will consider short-term rental (STR) strategy to be prefable to long-term rental (LTR) strategy if the following inequality holds:

\begin{equation}
Rev_{ST} > Rev_{LT}
\end{equation}

More specifically, if:

\begin{equation}
(Rate_{N} * O_{Total}) - U > (Rent_{M} * (12 - C_{S})) - L
\end{equation}

## Data

Data for this study were gathered from two different sources, one for short-term rental market and one for the long-term rental market.  Short-term rental market observations are from the Airbnb online portal. Airbnb is the largest short-term rental hub in the Melbourne region. As opposed to similar sites such as VRBO.com and Homeaway.com which focus on vacation homes in tourist dominated areas such as beaches and ski resorts, Airbnb offers considerable coverage in urban areas and, therefore, directly competes to a greater degree with more traditional long-term rentals than the other sites. The data on the Airbnb market in Melbourne have been purchased from www.airdna.co, a data provider specializing in Airbnb data collection and analysis. The short-term data include two types of observations, property level and nightly. Property-level data consists of a single observation for each property that is or has been listed on the Airbnb portal over the October 2014 to August 2016 period^[This time period represents the period in which AirDNA was engaged in data collection in Melbourne.]  The nightly data offer one observation for each property for each night of the year during its time on the portal.  These nightly data indicate the advertised price, the occupancy status and a unique reservation identification.

The Airbnb data cover the Melbourne metropolitan region from October 1st, 2014 to August 30th, 2016. There are missing nightly observations during the time period before September 1, 2015. After initially imputed these observations we found the results unreliable and have structured the analysis to only cover the time period containing complete data.  All monetary values in the Airbnb data are in US dollars and have been converted to Australian dollars using the median of the exchange rate during this time period, 1.32 Australian dollars to 1 US dollar.

The data on long-term leases was provided by Australia Property Monitors (APM), a Fairfax Group company. In raw form, this dataset includes an observation for each rental property listing for each time a detail of the listing changed. For example, if a property were listed for rent for one month and the price was dropped once each week there would be four observations in the dataset. These four observations are grouped by an event-specific identification number. This number is specific to the listing event, not the property. In each case the last observation signifies the final price of the rental contract. We separate this data into two sets for efficiency reasons. The first data set includes all information about the property, physical and economic (date and amount of rental contract), while the second contains a property ID, a rental event ID, the list price and the date of the change. As such, the first dataset is a set of market observations with associated characteristics and the second is a listing history of each rental event. The long-term lease data cover the period from January 2014 to December 2015.

Unfortunately, there are no common identifiers between the two datasets as the Airbnb data does not include address. Both sets of data do include latitude and longitude, but in a dense urban area with many multiple-family dwellings it is impossible to match apartments based on a two-dimensional coordinates. As a result of this, we are unable to directly match observations from the two datasets. However, the number of properties that rented long-term for the 2014 to 2015 period and then switched to Airbnb for the 2015 to 2016 period are likely very small and this inability to directly match properties does not greatly impact our modeling strategy.

```{r set_constants, message=FALSE, warning=FALSE, comment=FALSE, echo=FALSE, results='hide'}

  exch.rate <- 1.32

```

### Preparation

Here we describe the operations that we have performed to prepare the two sets of raw data for analysis. Primarily, this involves the filtering out data errors, outlier values and other observations than contain data that do not fit our research questions. Additionally, as our data are from two different sources, a number of fields require standardization so that comparisons between the two leasing strategy options -- long-term rental (LTR) vs short-term rental (STR) -- can be made.

We begin by filtering observations by time. Our hypothetical leasing strategy decision is that of an investor who purchases a property on September 1, 2015 and must decide on traditional long-term rental versus an AirBNB-type, short-term rental approach to generating income. To determine the likely LTR rate for any given property, we will use the observed rental transactions from September 1, 2014 to August 31, 2015. Taking the Airbnb or STR approach allows the owner to change rates over time and is subjected to daily changes in the market (supply and demand factors). In this simulated example we will use AirBnB data from September 1, 2015 to August 31, 2016 to represent the actual AirBNB market conditions over the time period in question.

Next, we filter the data based on property types. AirBNB units are classified into 19 different property types. The most common are Apartments and Houses, the least common are Igloo, Tent, Treehouse and Yurt^[Property types are owner/lister defined, therfore it is likely that some designation, such as Igloo, at the very least, are not completely true representations of the property type]. For the sake of this analysis, we will collapse these twenty types into three types:

1. **House**:  Includes properties labeled 'House' or 'Townhouse'
2. **Apartment**: Includes properties labeled as 'Apartment' or 'Condominium'
3. **Other**: Includes properties labeled as 'Bed & Breakfast', 'Boat', 'Bungalow', 'Cabin', 'Camper/RV', 'Chalet', 'Dorm', 'Earth House', 'Hut', 'Igloo', 'Loft', 'Other', 'Tent', 'Treehouse', Villa' and 'Yurt.

Within the long-term rental data, property types fall into eight categories.  Like the AirBNB data we group these into three categories matching as best as possible to the AirBNB categories:

1. **House**:  Includes properties labeled 'Duplex', 'House', 'Terrace' or 'Townhouse'
2. **Apartment**: Includes properties labeled as 'Unit' or 'Studio'
3. **Other**: Includes properties labeled as 'Semi' and 'Villa'

Part of the difficulty in perfectly mapping property types from these two datasets is due to the fact that the long-term data uses Australian terms while the short-term data conforms to North American lexicon.  This is most apparent when talking about apartment dwellings.  In Australia these are referred to as Units or Studios, while in North American they are referred to as Apartments or Condominiums (depending on ownership structure)^[Also note that 'Apartment-type' ownership is very rare in Australia.  Nearly every multi-family dwelling is owned as a condominium.  See @berry2000investment for more information on the overall structure of the Australian market]. Additionally, Terrace homes are very common in many of the older suburbs of Melbourne and would be considered Rowhouses or, likely, Townhomes in the North American context.

The **Other** category only makes up a very small percentage of the properties in both the short and long term market; especially so in the long-term market (Figure 1) .  Additionally, a large proportion of the **Others** in the short-term data are Bed & Breakfast units, a use which doesn't fit with our research question. As a result, we remove the 'Others' from both the short- and the long-term rental data.

&nbsp;

```{r plot_pt, message=FALSE, warning=FALSE, cache=TRUE, comment=FALSE, echo=FALSE, results='hide', fig.height=3, fig.cap='Tenure Type by Property Type', fig.lp='typecomp'}

  load(paste0(fig.path, 'ltrtypes.RData'))
  load(paste0(fig.path, 'strtypes.RData'))

  ggMultiPlots(str.types, ltr.types, cols=2)
  
```

&nbsp;

Next, the short-term rentals properties can be listed as one of three types relating to the extent of the property which is able to be booked:

1. **Entire Home/Apt**: The entire home or apartment is available
2. **Private Room**: One room within a house or apartment is available
3. **Shared Room**: A bed within a room shared by another occupant(s) is available

As long-term rentals do not offer **Private Room** or **Shared Room** options^[Our dataset does not include rooming houses, purpose built student accommodations and other types of rentals which may offer private or shared room options] and our purpose here is a comparison of long- and short-term returns, we remove all short-term properties that do not lease the entire home or apartment. Unfortunately, this filter does remove about 40% of the short-term data (Figure 2), however, given the research question it is unavoidable.

&nbsp;

```{r plot_ltype, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=2.5, fig.width=3.75, fig.cap='Listing Type of Short Term Rentals', fig.lp='ltcomp'}

 load(paste0(fig.path, 'listtypes.RData'))

 list.types

```

&nbsp;

#### Structural Characteristics 

We now turn to filtering by structural characteristics. As the Airbnb data provides limited information on the structural characteristics, the only overlapping fields that we have between the two datasets are bedrooms and bathrooms. Additionally, as the markets and structural components of houses and apartments differ, we bifurcate our analysis between the two property types from this point forward. 

We begin by removing all properties that are missing bedroom or bathroom information or have a likely data error in this fields (more than 14 bedrooms or 10 bathrooms). For both short and long term rentals we find that most apartments have fewer than four bedrooms and houses fewer than five.  For both property types, the vast majority of properties have three or fewer bathrooms. We filter the data accordingly. Additionally, note that short term rentals consider studio apartments to be 0 bed units while the long term data considers these as 1 bedroom. We convert the 0 bed short term units to 1 bed units. A few short term properties indicate no baths, which is likely an error so we remove these observations from the data. Also, here we notice that the short term data gives bathrooms in halves, while the long term data presents baths in whole numbers.  We round the baths in the short term data up to whole integers.

In addition to looking at bedrooms and bathrooms as separate dimensions of properties, they can also be considered together.  In other words, it is very common in the industry (and when looking for a short-term rental) to specify searches by bed/bath combination for obvious reasons -- 1 bedroom with 3 baths is inefficient and 4 bedrooms with 1 bath is uncomfortable.  As a result we examine the combinations of the two (Figure 3). From this analysis we see that there are 6 combinations that make up most all properties:  1bed/1bath, 2/1, 2/2, 3/1, 3/2 and 4/2. We filter the data to these combinations. 

&nbsp;

```{r plot_bb, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=4, fig.width=5.75, fig.cap='Bed/Baths by Property Type', fig.lp='bbcomp'}

 load(paste0(fig.path, 'ltrbb.RData'))
 load(paste0(fig.path, 'strbb.RData'))
 
 stbb <- stbb + ylab('# of Obs')
 ltbb <- ltbb + ylab('# of Obs')
 
 ggMultiPlots(stbb, ltbb)
  
```

&nbsp;

### Rates and Rental values

Next we filter by the prices -- the nightly rates and weekly rental values. The long term rental data have a single price observation, the asking rent at closing.  For the short term data, there are two indicators of nightly rate.  First, each property has a average nightly rate figure that takes the average of the rates for all booked nights over the October 2014 to August 2016 period. Second, there is a rate for each day in the daily observations. For the vast majority of properties, the daily rates change very little, but for a select few there is a wide variation in the daily rates, often somewhat randomly. In cases where a small number of reservations have been made, the average nightly rate can deviate widely from usual rate due to outliers on the high end. To remedy this, we create a new property-level variable that is the median nightly rate of successful bookings over the September 1, 2015 to August 31, 2016 period.

After removing property level observations that are missing price data, we plot the distribution of the rates and rents.  In Figure 4 we see that most long term weekly rentals are greater than \$200 and less than \$1,000 per week while most median nightly rates are greater than \$50 and less than \$500 per night. We filter the property level data accordingly. We also filter the short term daily data to include only those observations with nightly rates between \$50 and \$500.

&nbsp;

```{r plot_ratesrents, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=3, fig.width=5.75, fig.cap='Distribution of Rates and Rents', fig.lp='rrcomp'}

 load(paste0(fig.path, 'rateplot.RData'))
 load(paste0(fig.path, 'rentplot.RData'))

 ggMultiPlots(rate.plot, ltr.plot, cols=2)
  
```

&nbsp;

### Location and Submarkets

Location is an important determinant in both the short- and long-term rental markets. At the broadest scale, the long-term Melbourne residential market is usually discussed in terms of Inner, Middle and Outer suburbs.  In general, prices are highest in the inner suburbs and lowest in the outer, with a number of exceptions in the high end neighborhoods in the east and southeastern areas of the middle suburbs.  Suburbs in Melbourne are much smaller than their North American counterparts. The specific suburb of a property is the second, or finer scale, at which the market operates. Figure 5 shows the three large submarkets (Inner, Middle and Outer) and the individual suburbs boundaries.

&nbsp;

```{r plot_suburbmap, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=4, fig.width=4, fig.cap='Melbourne Submarkets', fig.lp='submap'}

 load(paste0(fig.path, 'suburbMap.RData'))

 loc.map <- loc.map +     
   theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
         axis.ticks.y=element_blank(),
         axis.title.x=element_blank(),
         axis.text.x=element_blank(),
         axis.ticks.x=element_blank())

 loc.map 
 
```

&nbsp;

It is likely that the short-term rental market follows a similar market hierarchy, however, we can imagine that a few different spatial features can influence the short-term market.  While there are many possible additional features, we consider two to be the most likely to influence rates or occupancy: 1) Proximity to beaches; and 2) Proximity to key tourist activities and events. Using the three broad submarkets from the long-term market (inner, middle and outer) we have created a five sub-market system as a starting point for spatially analyzing short and long term rentals in Melbourne: 

1. Rural (Outer suburbs, not Beach)
2. Suburban (Middle suburbs, not Beach)
3. City (Inner Suburbs, not Beach, not Core)
4. City-Core (Select inner suburbs with tourist activities and near CBD)
5. Beach (Properties within 500m of Port Phillip Bay east of Yarra River)

We select the 18 suburbs below to represent the 'core' of the city (Table 1).  The majority of tourist destinations and major events such as the Australian Open and the Grand Prix are located in these suburbs.  All are well serviced by public transportation and possess abundant amenities for tourists.

&nbsp;

```{r table_corelist, results="asis", comment=FALSE, message=FALSE, echo=FALSE, fig.cap='List of Core Suburbs', fig.lp='coresuburbs'}

 c.subs <- data.frame(A=core.suburbs[1:6],
                      B=core.suburbs[7:12],
                      C=core.suburbs[13:18])
 names(c.subs) <- NULL
 rownames(c.subs) <- NULL

 print(xtable(c.subs, caption = 'List of Core Suburbs\n'),
       include.rownames=F,
       caption.placement="top",
       hline.after=c(0,6))


```

&nbsp;

We assign these designations by: 1) Adding suburb designations to the properties; 2) Assigning submarkets 1-4 based on suburb location; and 3) Indicating proximity to beach and labeling as 'Beach' submarket.  This process is repeated for both the short and long term data. Finally, we also remove any observations that fall outside of outer suburbs (the extent of the suburbs). The location of the short and long term rentals, colored by submarket, are shown in Figure 6.

Before assigning submarkets to the long term property we must remedy the fact that about 5% of the long term rental observations have missing latitude and longitude values.  Half of these do, however, have a latitude and longitudeg value for the centroid of the street that the property faces.  To retain as many observations as possible in these intial steps we apply the street centroid value to the observations with missing lat/long values.  For those without either set of lat/longs we remove them from the dataset at this point. After making this correction we then assign one of the five submarket designations based on the process described above.

&nbsp;

```{r plot_locations, message=FALSE, warning=FALSE, comment=FALSE, cache=FALSE, echo=FALSE, fig.width=5.5, fig.height=9, fig.cap='Location Maps', fig.lp='locmaps'}

  load(paste0(fig.path, 'ltrMap.RData'))
  load(paste0(fig.path, 'strMap.RData'))

  str.map <- str.map +
   theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
         axis.ticks.y=element_blank(),
         axis.title.x=element_blank(),
         axis.text.x=element_blank(),
         axis.ticks.x=element_blank())

  ltr.map <- ltr.map +
   theme(axis.title.y=element_blank(),
         axis.text.y=element_blank(),
         axis.ticks.y=element_blank(),
         axis.title.x=element_blank(),
         axis.text.x=element_blank(),
         axis.ticks.x=element_blank())
  
  ggMultiPlots(str.map, ltr.map, cols=1)

```

&nbsp;

To better visualize the relative frequency of the submarkets in the two tenure types we have broken down the data by submarket by property type by tenure type. A number of interesting observations are illustrated here (Figure 7). First, the vast majority of Airbnb units are apartments in city-core or city locations. As expected and as shown by the map, the long term properties are more evenly spread across the metro region than the short term properties.  Long term houses are more peripheral than apartments, a result of urban development patterns and land economics. Beach properties are, relatively speaking, over-represented in the short term market, especially in apartments, while suburban and rural apartments, somewhat common in long term markets, are nearly absent in the short-term market. Overall, the suburban and rural Airbnb markets are quite thin, later results focusing on these markets will need to be examined in light of this small sample size.

&nbsp;

```{r plot_locbars, message=FALSE, warning=FALSE, comment=FALSE, cache=FALSE, echo=FALSE, fig.width=8.5, fig.height=4, fig.cap='Submarket Observation Counts', fig.lp='locbars'}

  load(paste0(fig.path, 'ltrsubplot.RData'))
  load(paste0(fig.path, 'strsubplot.RData'))
  ltrtype.map <- ltrtype.map + ylab("")

  ggMultiPlots(strtype.map, ltrtype.map, cols=2)

```

&nbsp;

### Summary of Data Cleaning

We have applied ten separate filters to our two datasets. In the name of transparency and to highlight the bounds of our research questions it is useful to review these filters (Table 2). There are more than 20,000 properties that are or have been listed on the Airbnb portal in Melbourne during the 2014 to 2016 period.  Filtering those not listed during the study period removes nearly 1/3 of all properties.  Further removing by property type and listing type (not entire home) elimates another 50% of the remaining properties.  From these 7,200 properties structural characteristics remove another 480 from consideration.  Over 1,000 of the remaining properties were never been booked and/or had outlying nightly rates and were removed.  Finally, 14 properties had either bad location data or missing information host policy. From over 20,000, we have 5,788 Airbnb properties meet the requirements of our research question.

For the long term data, over half of the observations fall outside of our considered time frame, reducing the sample size down to around 130,000 from 290,000.  Further consideration regarding property types, structural characteristics, location, etc. remove another 12,000 observations, leaving 120,092 in the final dataset.

&nbsp;

```{r table_cleansummary, results="asis", comment=FALSE, message=FALSE, echo=FALSE, fig.cap='Data Cleaning Summary', fig.lp='cleansumm'}

cc <- clean.count[,c('operation', 'str', 'ltr')]
str.count <- cumsum(c(cc$str[1], -cc$str[-1]))
ltr.count <- cumsum(c(cc$ltr[1], -cc$ltr[-1]))
str.cut <- c(0, str.count[-length(str.count)] - str.count[-1])
str.per <- c(0, str.cut[-1] / str.count[-length(str.count)])
ltr.cut <- c(0, ltr.count[-length(ltr.count)] - ltr.count[-1])
ltr.per <- c(0, ltr.cut[-1] / ltr.count[-length(ltr.count)])
clean.table <- data.frame(field=cc$operation,
                          strcount=str.count,
                          strcut=str.cut,
                          strper=str.per,
                          ltrcount=ltr.count,
                          ltrcut=ltr.cut,
                          ltrper=ltr.per)

rownames(clean.table) <- NULL
clean.table$field <- c('Initial Count', 'Time', 'Property Type',
                       'Listing Type', 'Bedrooms', 'Baths', 'Bed/Bath Combo',
                       'Rates & Rents', 'Revenue', 'Location', 'Host Policy')
clean.table$strper <- 100*round(clean.table$strper, 2)
clean.table$ltrper <- 100*round(clean.table$ltrper, 2)
names(clean.table) <- c('Filter', 'Short Term', 'Cut', '% Cut',
                        'Long Term', 'Cut', '% Cut')
options(xtable.comment = FALSE)
print(xtable(clean.table, caption='Data Cleaning Summary\n',
       digits=0),
       include.rownames=FALSE,
       caption.placement='top')

```

&nbsp;

## Revenues, More Explanation

#### Revenue Calculations

Calculations of revenue for the observed and hypothetical long-term rentals are straightforward, weekly rent -- real or imputed -- times 52 minus search cost time and agency fees.  For the short-term rental it is somewhat more complicated.  First, we must deal with those properties that were not listed for the entire 12 month period.  Our data cleaning eliminated all properties that were listed for less than six months, however, it would be incorrect to compare the revenue of a property listed on Airbnb for seven months with the hypothetical annual revenue from a long term rental.  

Second, many of the short term properties have a significant number of blocked days, days in which the property was not offered on Airbnb.  Here too, there is a problem with comparing observed revenues from a property with a 40\% block rate with a hypothetical year long revenue stream, especially if the property was leased out on other portal during those blocked days.  And, even if we knew that the blocked days were simply due to the host wanting to use the property themselves during that time, this deduction in revenue should not necessarily apply to the hypothetical investor in our examined scenario.  In short, in either case, the actual observed short-term revenue would be biased on the low end compared to what a revenue maximizing owner would be likely able to accomplish.  

As a result, we have calculated three separate revenues values for the short-term properties:

1. \textbf{Actual ($REV_a$)}: Observed bookings multiplied by median nightly rate
2. \textbf{Extrapolated ($REV_e$)}: Observed bookings extrapolated to a full year^[Properties listed in summer, but not winter may be over imputed and vice versa, however, we expect the biases to cancel out over the entire sample.] based on observed occupancy rate multiplied by median nightly rate
3. \textbf{Potential ($REV_p$)}: Observed occupancy rate of non-blocked days multiplied by 366 multiplied by median nightly rate 

Below we chart the distribution of the Extrapolated ($REV_e$) and Potential ($REV_p$) Short Term revenues against a distribution of the oserved long term revenues for the long term properties. Revenues from the long-term rentals are for more consistent, with the vast majority totaling between \$12,000 to \$30,000 per year (Figure 8).  Extrapolated short term revenues range from neglible to highs of greater than \$80,000, with many of the properties showing very limited (less than \$10,000) revenue. The range of the distribution for the Potential Short Term revenue is similar, however, the distribution itself is much flatter, with many more properties showing potential incomes in the \$20,000 to \$40,000 range. 

While this simple analysis does not control for location and product differences, it does highlight the fact that some Airbnb owners are likely making greater revenues than in long-term rentals, but that most are likely not.  When looking at potential revenues, however, a great deal more may have the potential to produce more revenue.  The high number of very low yield Airbnb properties in the Extrapoted condition suggests that some owners may not be focused on maximizing revenue, but instead prefer the flexibility of short-term leasing^[Do note that we have not considered any overall market demand issues when analyzing potential revenue.].

&nbsp;

```{r plot_revdens, message=FALSE, warning=FALSE, comment=FALSE, cache=FALSE, echo=FALSE, fig.width=6,fig.height=3.5, fig.cap='Comparison of Revenue Distributions', fig.lp='revdens'}

  stre <- str.data[,c('bedrooms', 'str.ext.revenue')]
  stre$tenure <- 'short-term extrapolated   '
  names(stre)[2] <- 'revenue'
  strp <- str.data[,c('bedrooms', 'str.pot.revenue')]
  strp$tenure <- 'short-term potential   '
  names(strp)[2] <- 'revenue'
  ltrr <- ltr.data[,c('bedrooms', 'ltr.revenue')]
  ltrr$tenure <- 'long-term   '
  names(ltrr)[2] <- 'revenue'
  allr <- rbind(stre, strp, ltrr)

  ggplot(allr, aes(x=revenue, fill=tenure, color=tenure)) +
    geom_density(alpha=.5) +
    scale_fill_manual(values=c(ltr.col, abb.col[2], str.col)) +
    scale_color_manual(values=c(ltr.col, abb.col[2], str.col)) +
    ggtitle('Annual Revenues by Tenure Type') +
    xlab('Annual Revenue') +
    scale_x_continuous(breaks=c(seq(0,60000, by=20000)),
                       labels=c('$0', '$20,000', '$40,000', '$60,000'))+
    theme(legend.position='bottom',
          legend.title = element_blank(),
          plot.title = element_text(hjust = 0.5),
          axis.text.y = element_blank(),
          axis.ticks.y = element_blank(),
          axis.title.y=element_blank()) +
    coord_cartesian(xlim=c(0, 70000))

```

&nbsp;

#### Classifying Hosts

As the difference between extrapolated and potential revenue suggests, many short-term hosts are not listing their properties full-time.  There may be, therefore, different types of hosts operating in the Airbnb market. from anecdotal evidence, there are at least two types of hosts in the market: 1) Those that lease out their properties all the time in the name of profit maximization (Profit Seekers); and 2) Those that lease out their property when very infrequently, for example when they are away on vacation (Opportunistic Sharers).

If these are the dominant two forms of hosts in the market, then a distribution of properties by the percent of time which they are blocked shoudl be very bi-modal with profit seekers on the left and opportunistic sharers on the right. The left hand panel of figure 9 shows that this breakdown hold somewhat, with peaks of hosts at each end, but that there are also a considerable number of hosts who block their properties some of the time.  

There is also a third potential host type, that of the host who utilizies multiple platforms, of which Airbnb may just be one, to list their short-term property. A potential method to identify these hosts is to look at the number of individual periods of blocked days.  A host using multiple platforms will likely have many, small periods of blocked days on Airbnb as they will block out those days in which reservations are made on other platforms. We test to see if this is a meaningful metric by plotting the total count of blocked periods versus the percentage of blocked days in the right panel of Figure 9. We do find many host with a large number of blocked periods, but, unfortunately, no true pattern emerges.  

&nbsp;

```{r build_blockfreq, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE}

  host.block.freq <- ggplot(str.data, aes(x=block.rate)) + 
  geom_density(fill=str.col, color=str.col) +
  ylab('Frequency\n') + 
  xlab('\n% of Time Property is Blocked') +
  scale_x_continuous(breaks=seq(0,1,.2),
                     labels=c('0%', '20%', '40%', '60%', '80%', '100%')) +
    ggtitle('Host Block Rate Frequency\n') +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme(axis.text.y=element_blank(),
          axis.ticks.y=element_blank())
```

```{r build_blockrate, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE}

  block.rate.period <- ggplot(str.data, aes(x=block.rate, y=nbr.block*extr.par)) + 
  geom_point(fill=str.col, color=str.col, size=.2) +
  ylab('Nbr of Blocked Periods\n') + 
  xlab('\n% of Time Property is Blocked') +
  scale_x_continuous(breaks=seq(0, 1, .2),
                     labels=c('0%', '20%', '40%', '60%', '80%', '100%')) +
    ggtitle('Block Rate vs. Nbr. of Blocked Periods\n') +
    theme(plot.title = element_text(hjust = 0.5)) 

```

```{r plot_hostblock, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=3.5, fig.caption='Host Blocking Tendencies', fig.lp='hostblock'}

ggMultiPlots(host.block.freq, block.rate.period, cols=2)

```

&nbsp;

Attempts to divide the hosts up with unsupervised^[As there are no official host types we could not run more reliable supervised models.] clustering algorithms -- including the use of more variables -- failed to produce robust categories.  As a more subjective approach, we have divided the hosts up into four categories based on the original two variables considered: block percentage and number of blocked periods. Profit seekers are those host who have blocked percentages less than 25\% of the time.  Opportunistic Sharers have blocked their properties at least 75\% of the time.  Within those two extremes, we consider users who have at least 12 blocked periods during a year to be 'Multi-Platform Users' and the remaining set to be 'Unknown'.  See Figure 10 for a breakdown of these group by the two variables. 

&nbsp;

```{r calc_hosttypes, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE}

str.data$blockpertime <- round(str.data$nbr.block * str.data$extr.par, 1)

str.data$host.type <- 'Unknown'
str.data$host.type[str.data$blockpertime > 12] <- 'Multi-Platform User'
str.data$host.type[str.data$block.rate <= .25] <- 'Profit Seeker'
str.data$host.type[str.data$block.rate >= .75] <- 'Opportunistic Sharer'
str.data$host.type <- factor(str.data$host.type,
                             levels=c('Profit Seeker', 'Opportunistic Sharer', 
                                      'Multi-Platform User', 'Unknown'))
```

```{r build_hostbase, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE}

base.host <- ggplot(str.data, 
                    aes(x=block.rate, y=blockpertime)) + 
                geom_point(alpha=.7, size=.4, shape=16, color='gray70') +
                ylab('# Blckd Periods\n') + 
                xlab('\n% of Time Property is Blocked') +
                ggtitle('Block Rate vs. Nbr. of Blocked Periods\n') +
                scale_x_continuous(breaks=seq(0, 1, .2),
                                   labels=c('0%', '20%', '40%', 
                                            '60%', '80%', '100%')) +
                #scale_color_manual(values=c(abb.col[2], abb.col[4], 
                #                            abb.col[7], abb.col[9])) + 
                theme(legend.position='bottom',
                      legend.title = element_blank(),
                      plot.title = element_text(hjust = 0.5))+
                guides(colour = guide_legend(override.aes = list(size=3,                                                                       alpha=1)))

```

```{r build_hosttypes, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE}
  
ps.host <- base.host + 
  geom_point(data=str.data[str.data$host.type == 'Profit Seeker', ], size=.4)  +
  ggtitle('Profit Seekers')
os.host <- base.host + 
  geom_point(data=str.data[str.data$host.type == 'Opportunistic Sharer', ], 
             size=.4)  +
  ggtitle('Opportunistic Sharer')
mu.host <- base.host + 
  geom_point(data=str.data[str.data$host.type == 'Multi-Platform User', ], 
             size=.4)  +
  ggtitle('Multi-Platform User')
un.host <- base.host + 
  geom_point(data=str.data[str.data$host.type == 'Unknown', ], size=.4)  +
  ggtitle('Unknown')

```

```{r plot_hosttypes, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=3.5, fig.caption='Host Categories', fig.lp='hosttypes'}

ggMultiPlots(ps.host, mu.host, os.host, un.host, cols=2)
  
```

&nbsp;

Profit Seekers make up 43\% of the hosts, with Opportunistic Sharers capturing 18\% and Multi-Platform Users 10\%.  The remainder 'Unknown' category contains just over 28\% of all properties. The classification of these hosts is not convincing enough to base our entire analytical process on so we will use these breakdowns to add context to the results and to test the sensitivity of our results to the assumptions underlying the extrapolated and potential revenue calculations.   

&nbsp;

```{r plot_hostbar, message=FALSE, warning=FALSE, comment=FALSE, cache=TRUE, echo=FALSE, fig.height=4, fig.caption='Host Type Counts', fig.lp='hostbar'}

host.type.bar <- ggplot(str.data, aes(host.type, fill=host.type)) +
  geom_bar() +
  scale_fill_manual(values=c(abb.col[2], abb.col[4], abb.col[7], abb.col[9]))+
  theme(legend.position='none') +
  ylab('Frequency\n') + 
  xlab('\nHost Type') +
  ggtitle('Short Term Host Types') + 
  theme(plot.title = element_text(hjust = 0.5))

host.type.bar

```

&nbsp;

## Comparison

In this section we compare net revenues between long and short term rental options.  As mentioned above, there are no direct matches between the datasets. In other words, we have not directly observed a property which has been in a long-term rental followed by short-term or vice versa.  We will, instead, make the comparisons between the two by imputing likely long-term rental revenues for the observed short-term properties and then comparing the observed revenues to the imputed revenues.

We make our imputations via a hedonic price models. We model the long-term market with the long-term data and then use this model to predict or impute the likely long-term rental for the short term properties. We use the following model specification:

\begin{equation}
  \label{eq:test}
ln(RentLT_{i}) = \beta_{1} BedBath_{i} + \gamma_{2} Suburb_{i} + \tau_{3} Time_{i} + \epsilon_{i}
\end{equation}

where $ln(RentLT_{i})$ is the natural log of the weekly rent, *BedBath* is the bedroom/bathroom combination, *Suburb* is a fixed effect for the location of the property, *Time* is the month of rental and $\epsilon$ a random error term.

We then compare the projected net revenue of the short-term properties to their observed revenues, both Extrapolated ($REV_e$) and Potential ($REV_p$), to judge the likelihood of short-term preference.  

Realizing that the imputed long term rental values may be more accurate when estimated at smaller scales, we impute long term rental rates at submarket level, specifically by type, bed/bath and geographic area.  In other words, we separately estimate LTR rents for Apartments with 1bed/1bath in the city core, Apartments with 1bed/1bath in the beach submarket, etc. for all combinations of type, bed/bath and geographic area. We then combine the results form all estimates back into a single dataset that contains all of the short-term rentals. 

### Results

We will begin our analysis by making a comparison of the short and long-term markets at the metropolitan level.  Of our sample of 5,783 short-term rental units, 1,600 or 27.7\% of those units recorded a net revenue greater than what would likely have been garnered in the long-term market.  

Occupancy rates are one of the most important components in determining the profitability of short-term rentals. Below we show (left-panel, Figure 9) the percentage of properties for which short-term rental is more profitable versus the occupancy rate over the year analyzed. We see that likelihood of short-term rental being a better option increases sharply with occupancy rate up from about 25\% up to 75\% occupancy. For occupancy rates less than 40\%, long-term rental is more likely to be preferable. 

As the distribution of occupancy rates is not uniform the initial plot may be misleading as to the frequency of short-term rentals being more profitable than long term. In the right hand panel of Figure 9 we transform the x-axis to represent the quantile of the full distribution of occupancy rates. By doing so, we see that, in general, properties need to be in the upper 25th percentile of occupancy rates across the entire market in order to have a equal likelihood of being more profitable as a short-term rental than as a more traditional long term one. As a matter of reference, the mean occupancy rate in the sample is 27.6\%, with a median value of 19.4\%. 

&nbsp;

```{r message=FALSE, warning=FALSE, comment=FALSE, cache=FALSE, echo=FALSE, fig.width=7, fig.height=3.5, fig.cap='Probability of Short Term Pref. vs Occ. Rate'}

  str.data.ic$pref <- str.data.ic$str.ext.pref

  rawocc <- abbPrefPlot(str.data.ic,
                         x.field='occ.rate',
                         smooth=TRUE,
                         smooth.span=.5)
  
  rawocc <- ggplot(rawocc$data,
                   aes(x=x.var, y=Var))+
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='none') + 
    ggtitle('Raw Rates') + 
    theme(plot.title = element_text(hjust = 0.5))
  
  
  str.data.ic$occ.qtl <- makeWtdQtl(str.data.ic$occ.rate, 
                                      return.type='rank') 
  str.data.ic$rate.qtl <- makeWtdQtl(str.data.ic$med.rate, 
                                  return.type='rank') 
  qtlocc <- abbPrefPlot(str.data.ic,
                        x.field='occ.qtl',
                        smooth=TRUE,
                        smooth.span=.5)
  
  qtlocc <- ggplot(qtlocc$data,
                   aes(x=x.var, y=Var))+
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate (Quantile)') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25th', '50th', '75th', '100th')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='none') + 
    ggtitle('Quantile Rates') + 
    theme(plot.title = element_text(hjust = 0.5))
   
  ggMultiPlots(rawocc, qtlocc, cols=2)
```

&nbsp;

Along with occupancy rates, the other important consideration is the nightly rate.  High occupancy rates with low nightly rates may not be any better than lower occupancy rate with a higher nightly rate.  In Figure 10 (left panel) we plot nightly rates versus occupancy rates.  We then divide the area of the scatter plot into 400 equal areas (20 x 20) and color each based on which is more common in the area, short term or long term revenue.  The transparency is related to the total count of actual market properties falling into that area.

The general trend is what is expected, i.e. that higher rates and occupancies, ceteris paribus, means more profitability for short term rentals.  This relationship is not a perfectly linear because the long-term rental revenue varies greatly based on the characteristics of the property.  While the left panel of Figure 16 helps show the general pattern is does leave many indeterminate areas.  In order to better delimit the situations where short-term rentals are more profitable we turn to a support vector machine (SVM) algorithm.

An SVM can be used as a classifier to delineate the boundaries between two (or more) classes of observations.  In this case, we delineate the boundary (right panel) between situations where long-term rentals are more profitable (red) and where short term are (green).  In order to avoid an overly broad straight line delineation we use a polynomial fitting technique. While this process does provide more flexible fit in the area of high data density, it also has the side effect of creating somewhat counter intuitive results in areas of low data (such as the far upper right corner.)  Overall, from the SVM model we see that the short-term preference begins at about 30\% occupancy rate, regardless of nightly rate.  As the occupancy rate increases, the required nighly rate decreases, down to near $100 once occupancies hit 65\% or greater.

&nbsp;

```{r, fig.width=8, fig.height=4, echo=FALSE, fig.align='center', fig.cap='Analysis of Raw Rates: Metro Level'}

  rate.hm <- abbHeatMap(str.data.ic,
                x.field='occ.rate',
                y.field='med.rate',
                pref.field='str.ext.pref',
                svm=F, 
                alpha.count=T,
                add.points=T,
                fill.colors=c(abb.col[1], abb.col[5]))
  rate.hm <- rate.hm + ylab('Nightly Rate')

  rate.hm.svm <- abbHeatMap(str.data.ic,
                            x.field='occ.rate',
                            y.field='med.rate',
                            pref.field='str.ext.pref',
                            svm=T, 
                            alpha.count=F,
                            add.points=T,
                            fill.colors=c(abb.col[1], abb.col[5]))
  rate.hm.svm <- rate.hm.svm + ylab('Nightly Rate')
  
  ggMultiPlots(rate.hm, rate.hm.svm, cols=2)

```

&nbsp;

Both the occupancy rates and the nightly rates are not uniformly distributed and therefore the plots in Figure 10 may be misleading.  We convert both axis to quantiles and replot both in Figure 11.  Here we see a more even distibution of points across the figures.  Additionally, a more reasonable SVM breakdown occurs as well.  The right panel shows that in order for the likelihood of a property to be more profitable in short-term rental to be above 50\% the lowest occupancy rate it can have is 40\%, if the nightly rate is in the top 95th percentile of the market.  For example, if we drop the nightly rate to the median, the occupancy rate need to be at the 60th percentile.

&nbsp;

```{r, fig.width=8, fig.height=4, echo=FALSE, fig.cap='Analysis of Quantile Rates: Metro Level'}

  qtl.hm <- abbHeatMap(str.data.ic,
                x.field='occ.qtl',
                y.field='rate.qtl',
                pref.field='str.ext.pref',
                svm=F, 
                alpha.count=T,
                add.points=T,
                fill.colors=c(abb.col[1], abb.col[5]))
  qtl.hm <- qtl.hm + ylab('Nightly Rate')
 
  qtl.hm.svm <- abbHeatMap(str.data.ic,
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T, 
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))
  qtl.hm.svm <- qtl.hm.svm + ylab('Nightly Rate')
 
  ggMultiPlots(qtl.hm, qtl.hm.svm, cols=2)
  
```

&nbsp;

\pagebreak

### Submarkets

To gain a deeper understanding of the differences in short-term preference, we break the data down across a variety of characteristics and examine the preferability metrics in these submarkets. First, we bifurcate our data into houses and apartments.  Within the houses, 17.5\% of the properties are short-term preferable, while for the apartment that figure is nearly double at 30.5\%. Plotting the changes in short-term preferability against occupancy rates shows considerable similarity between houses and apartments (Figure 12).  The only measurable difference is in that for houses a properties occupancy rate needs to be about in a higher quantile (by about 10) than apartments to show the same likelihood of short-term preference as apartment.  Or, in other words, a given house needs to outperform its peers by a greater extent than an apartment to achieve short term preferenc.e 

&nbsp;

```{r message=FALSE, warning=FALSE, comment=FALSE, cache=FALSE, echo=FALSE, fig.width=7, fig.height=3.5, fig.cap='Preferency vs Occ. Rates: By Type'}

  apt.id <- which(str.data.ic$type == 'Apartment')
  house.id <- which(str.data.ic$type == 'House')
  type.data.ic <- str.data.ic

  ptrocc <- abbPrefPlot(type.data.ic,
                         x.field='occ.rate',
                         split.field='type',
                         smooth=TRUE,
                         smooth.span=.5 ,
                         spl.col=c('black', 'grey40'))
  
  ptr.occ <- ggplot(ptrocc$data,
                    aes(x=x.var, y=Var, group=ID, color=ID)) +  
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate') +
    scale_color_manual(values=c('black', 'grey60'),
                       name='') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='bottom') + 
    ggtitle('Raw Rates') + 
    theme(plot.title = element_text(hjust = 0.5))
  

  type.data.ic$occ.qtl[apt.id] <- makeWtdQtl(type.data.ic$occ.rate[apt.id],
                                      return.type='rank')
  type.data.ic$occ.qtl[house.id] <- makeWtdQtl(
    type.data.ic$occ.rate[house.id], return.type='rank')
  
  type.data.ic$rate.qtl[apt.id] <- makeWtdQtl(type.data.ic$med.rate[apt.id],
                                  return.type='rank')
  type.data.ic$rate.qtl[house.id] <- makeWtdQtl(
    type.data.ic$med.rate[house.id], return.type='rank')
  
  ptqocc <- abbPrefPlot(type.data.ic,
                         x.field='occ.qtl',
                         split.field='type',
                         smooth=TRUE,
                         smooth.span=.5 ,
                         spl.col=c('black', 'grey40'))
    
  ptq.occ <- ggplot(ptqocc$data,
                    aes(x=x.var, y=Var, group=ID, color=ID)) +  
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate (Quantile)') +
    scale_color_manual(values=c('black', 'grey60'),
                       name='') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25th', '50th', '75th', '100th')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='bottom') + 
    ggtitle('Quantile Rates') + 
    theme(plot.title = element_text(hjust = 0.5))
   
  ggMultiPlots(ptr.occ, ptq.occ, cols=2)

```

&nbsp;

Extending this analysis to also include nightly rates shows a similar situation (Figure 13). For houses (left panel) there are very few combinations of occupancy rate and nightly rate that offer a greater than even likelihood of short-term preference.  As an example, a median nightly rate requires a 90\% occupancy rate. The market for apartment (right panel) is more forgiving and occupancy rates as low as the 60th percentile can equate to a greater than even chance of short-term prefence is coupled with nightly rates near the top of the market.  A median nightly rate requires a 70\% occupancy rate for short-term prefernce likelihood. 

&nbsp;

```{r, fig.width=8, fig.height=4, echo=FALSE, fig.cap='Analysis of Quantile Rates: By Type'}

### UPDATE THE QTL VALUES

  house.hm.svm <- abbHeatMap(type.data.ic[type.data.ic$type ==
                                          'House', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5])) +
  theme(legend.position='none') +
  annotate("text", x = 50, y = 50, label = "Houses", size=9)

  apt.hm.svm <- abbHeatMap(type.data.ic[type.data.ic$type ==
                                          'Apartment', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none')+
  annotate("text", x = 50, y = 50, label = "Apartments", size=9)

  ggMultiPlots(house.hm.svm, apt.hm.svm, cols=2)


```

&nbsp;

#### By Geography

Next, we divide the data by the five geographic sub-market shown in Figure 6. Within the City-Core, approximately one out of three short-term properties brought in more net revenue than they likely would have under a long-term leasing scenario.  That figure drops to one in four for beach and rural properties, one in six for other city location and about one in nine for suburban locations. 

&nbsp;

```{r message=FALSE, warning=FALSE, results='asis', comment=FALSE, cache=TRUE, echo=FALSE, fig.cap='Geographic Submarket Preferability'}

 # Make Basic comparison table
  pref.table <- abbCreateCompTable(ic.df=str.data.ic,
                                   split.field='sub.mrkt')

 # Convert to wide format for output
  pref.table.wide <- dcast(pref.table, ID ~ rev.type, value.var='Var')

 # Limit to the extrapolated pref type
  pref.table <- pref.table[pref.table$rev.type == 'Extrapolated', ]
  pref.table[,1] <- c('City-Core', 'City', 'Suburban', 'Rural', 'Beach')
  pref.table[,2] <- pref.table[,2]*100

  names(pref.table) <- c('Sub-Market', '% Short Term Preferable')
  options(xtable.comment = FALSE)
  print(xtable(pref.table[,1:2], caption='Geographic Submarket Preferability\n',
               digits=1),
               include.rownames=FALSE,
               caption.placement='top')

```

&nbsp;

There is a noticable variability in the relationship between occupancy rates and short-term prefernce across the submarkets. For raw rates (Figure 14, left panel), rural properties can acheive short-term preference with lower occupancies than the other areas. This may be due to the relatively low long-term rental rates in the more rural areas coupled with high short-term rates for homes in wine country or near the mountainous terrain east of the city. Transforming to quantiles, we see that the city-core properties can reach short-term preference at a much lower occupancy rate than the other, with suburban and city as the most difficult markets.  

&nbsp;

```{r, fig.width=8, fig.height=4, echo=FALSE, fig.cap='Analysis of Quantile Rates: Metro Level'} 

  cc.id <- which(str.data.ic$sub.mrkt == 'city-core')
  city.id <- which(str.data.ic$sub.mrkt == 'city')
  sub.id <- which(str.data.ic$sub.mrkt == 'suburban')
  rural.id <- which(str.data.ic$sub.mrkt == 'rural')
  beach.id <- which(str.data.ic$sub.mrkt == 'beach')
  
  subm.data.ic <- str.data.ic

  subm.data.ic$occ.qtl[cc.id] <- makeWtdQtl(subm.data.ic$occ.rate[cc.id],
                                      return.type='rank')
  subm.data.ic$rate.qtl[cc.id] <- makeWtdQtl(subm.data.ic$med.rate[cc.id],
                                  return.type='rank')
  
  subm.data.ic$occ.qtl[city.id] <- makeWtdQtl(
      subm.data.ic$occ.rate[city.id], return.type='rank')
  subm.data.ic$rate.qtl[city.id] <- makeWtdQtl(
    subm.data.ic$med.rate[city.id], return.type='rank')
  
  subm.data.ic$occ.qtl[sub.id] <- makeWtdQtl(subm.data.ic$occ.rate[sub.id],
                                      return.type='rank')
  subm.data.ic$rate.qtl[sub.id] <- makeWtdQtl(subm.data.ic$med.rate[sub.id],
                                  return.type='rank')
  
  subm.data.ic$occ.qtl[rural.id] <- makeWtdQtl(subm.data.ic$occ.rate[rural.id],
                                      return.type='rank')
  subm.data.ic$rate.qtl[rural.id] <- makeWtdQtl(subm.data.ic$med.rate[rural.id],
                                  return.type='rank')
  
  subm.data.ic$occ.qtl[beach.id] <- makeWtdQtl(subm.data.ic$occ.rate[beach.id],
                                      return.type='rank')
  subm.data.ic$rate.qtl[beach.id] <- makeWtdQtl(subm.data.ic$med.rate[beach.id],
                                  return.type='rank')
  
```

```{r, fig.width=9, fig.height=4, message=FALSE, warning=FALSE, echo=FALSE, fig.cap='Analysis of Quantile Rates: Metro Level'} 

  sm.col <- abb.col[c(1, 3, 6, 5, 2)] 
  smrocc <- abbPrefPlot(subm.data.ic,
                         x.field='occ.rate',
                         split.field='sub.mrkt',
                         smooth=TRUE,
                         smooth.span=.5 ,
                         spl.col=sm.col)
  
  smr.occ <- ggplot(smrocc$data,
                    aes(x=x.var, y=Var, group=ID, color=ID)) +  
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate') +
    scale_color_manual(values=sm.col,
                       name='') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='bottom') + 
    ggtitle('Raw Rates') + 
    theme(plot.title = element_text(hjust = 0.5))


  smqocc <- abbPrefPlot(subm.data.ic,
                         x.field='occ.qtl',
                         split.field='sub.mrkt',
                         smooth=TRUE,
                         smooth.span=.5 ,
                         spl.col=sm.col)
    
  smq.occ <- ggplot(smqocc$data,
                    aes(x=x.var, y=Var, group=ID, color=ID)) +  
    geom_point(alpha=.5, size=.4) +
    stat_smooth(se=FALSE, size=2, span=.5) +
    xlab('\nOccupancy Rate (Quantile)') +
    scale_color_manual(values=sm.col,
                       name='') +
    scale_x_continuous(breaks=seq(0, 100, by=25),
                       labels=c('0%', '25th', '50th', '75th', '100th')) +
    ylab('\nSTR Preferability %') +
    scale_y_continuous(breaks=seq(0, 1, by=.25),
                       labels=c('0%', '25%', '50%', '75%', '100%')) +
    theme(legend.position='bottom') + 
    ggtitle('Quantile Rates') + 
    theme(plot.title = element_text(hjust = 0.5))
   
  ggMultiPlots(smr.occ, smq.occ, cols=2)
```

&nbsp;

Plotting out the nigthly rate versus occupancy rate heat maps for all five geographic submarkets tells a similar story.  The 'City-Core' market offers the most potential for short term prefernce with suburban and city the least.  The rural market achieves very sold short-term preference for the most expensive home, again likely those with special amenities or links to the wine region.  Beach properties do not perform as well as might be expected in the short term market, however, it should be kept in mind that the winter climate in Melbourne is not conducive to beach activity and therefore short-term beach properties may suffer during winter months. 

&nbsp;

```{r, fig.width=8, fig.height=4, echo=FALSE, fig.cap='Analysis of Quantile Rates: Metro Level'}

  core.hm.svm <- abbHeatMap(subm.data.ic[subm.data.ic$sub.mrkt ==
                                          'city-core', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none') +
    ylab('') +
    xlab('') +
  annotate("text", x = 50, y = 50, label = "City-Core", size=9)


    city.hm.svm <- abbHeatMap(subm.data.ic[subm.data.ic$sub.mrkt ==
                                          'city', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none')+
    ylab('') +
    xlab('')+
  annotate("text", x = 50, y = 50, label = "City", size=9)


      sub.hm.svm <- abbHeatMap(subm.data.ic[subm.data.ic$sub.mrkt ==
                                          'suburban', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none')+
    ylab('') +
    xlab('')+
  annotate("text", x = 50, y = 50, label = "Suburban", size=9)


      rural.hm.svm <- abbHeatMap(subm.data.ic[subm.data.ic$sub.mrkt ==
                                          'rural', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none')+
    ylab('') +
    xlab('')+
  annotate("text", x = 50, y = 50, label = "Rural", size=9)


      beach.hm.svm <- abbHeatMap(subm.data.ic[subm.data.ic$sub.mrkt ==
                                          'beach', ],
                   x.field='occ.qtl',
                   y.field='rate.qtl',
                   pref.field='str.ext.pref',
                   svm=T,
                   alpha.count=F,
                   add.points=T,
                   quantile=T,
                   fill.colors=c(abb.col[1], abb.col[5]))+
  theme(legend.position='none')+
    ylab('') +
    xlab('')+
  annotate("text", x = 50, y = 50, label = "Beach", size=9)

```

```{r, message=FALSE, warning=FALSE, fig.width=8, fig.height=8, echo=FALSE, fig.cap='xxx'}

  ggMultiPlots(core.hm.svm, city.hm.svm, sub.hm.svm,
               rural.hm.svm, beach.hm.svm, cols=2)

```

&nbsp;

## Explaining Preference

The analyses above show that, overall, just less than 1 out of every 3 Airbnb'd properties was actually more profitable as a short-term rental then it would have been if rented long-term over the course of the year. This proportion, however, varied by location and property type, with apartments and city-core properties showing the highest likelihood of short-erm preference. While illustrative, the above do not fully control for property characteristics or owner actions -- which are a key component of short-term rental success.  To better understand which factors are related to a higher likelihood of short-term preference, we develop a set of logistic regression models below. 

We specify three, increasingly complex, logistic regression models.  Model 1 takes the form of:

\begin{equation}
ln(\frac{STPref}{1-STPref}) = \beta_{0} + \beta_{1} PType + \beta_{2} BedBath + \epsilon
\end{equation}

where $StPref$ is the probability of short-term preference, $\frac{STPref}{1-STPref}$ is the log-likelihood of short-term prefernce, $PType$ is the property type (apt or house), $BedBath$ is the bedroom and bathroom combination of the property and $\epsilon$ is an error term.

For Model 2 we add the five geographic submarkets, $SubMrkt$ to better control for geographic variation in the probabilities.

\begin{equation}
ln(\frac{STPref}{1-STPref}) = \beta_{0} + \beta_{1} PType + \beta_{2} BedBath + \beta_{3} SubMrkt + \epsilon
\end{equation}

Finally, in Model 3 we add three variables describing policies set by the Airbnb hosts:

\begin{equation}
ln(\frac{STPref}{1-STPref}) = \beta_{0} + \beta_{1} PType + 
\beta_{2} BedBath + \beta_{3} SubMrkt +
\beta_3 GPR + \beta_{4} MinStay + \beta_5 CancelPolicy +  \epsilon
\end{equation}

where $GPR$ is the total number of guests allowed per bedroom^[Hosts set the total number of guests.  We have normalized this by bedroom to avoid co-linearity in our model with the bedroom variables.], $MinStay$ is the minimum number of nights that a stay may have and $CancelPolicy$ is the difficulty with which a booking may be cancelled.  We have grouped the cancellation policies into three groups, Flexible (24 hour notice), Moderate (5 day notice) and Strict (50\% refund, 7, 30 or 60 day notice required).

The results of all three models are shown in Table 7. For $PType$ apartments are the reference category,  for $BedBath$, 2Bed/2Bath is the reference category, for $Submrkt$ the Core is the reference category and for $CancelPolicy$ moderate is the reference category.  As the additional variables are added, the model fit diagnostics steadily increase, suggesting that the increased complexity of the models adds to the quality of the fit.

In Model 1, we see that when controlling for structural characteristics, Houses have a significantly lower probability of being more profitable in the short-term than apartments.  Small 1Bed/1Bath properties have a lower probability of being preferable in the short term than the reference class (2Bed/2Bath), while larger 3Bed/2Bath and 4Bed/2Bath have much higher probability of short term preference.

Adding the submarket variables (Model 2) shows that all areas have a much lower probability of short-term prefernce when compared to the core (the reference category) when controlling for structural characteristics.  These findings mirror those found above in Table 9.  The coefficients for the structural characteristics change little from Model 1 to Model 2, speaking the robustness of those estimates.

Finally, in Model 3 we add in host behavior or policies. Allowing a greater number of guests per bedroom results in a higher probability of short-term preference.  This variable may be operating a proxy for additional sleeping spaces which allow for a higher nightly rate, ceteris paribus, to be charged.  The greater the minimum stay, the lower the probability of short-term preference.  Longer minimum stay may equate to lower occupancy rates as one or two night travelers are exempted from the property.  Owners with longer minimum stays may be looking to minimize costs such as cleaning and administration.  Flexible cancellation policies result in a lower probability of short-term preference, while a Strict policy has a weak, but positive relationship with short-term preference.  Strict policies do help maintain revenues, but may also scare off some potential guests.  Strict cancellation may be a luxury for the best and highly desired properties on the market and, within our model, may be acting as a proxy for some unobserved measure of quality or demand.

&nbsp;

```{r, results='asis', echo=FALSE, message=FALSE, comment=FALSE, fig.cap='Logistic Model Results of Short Term Preference'}

 m1 <- as.data.frame(summary(pref.models[[1]])$coefficients)
 m2 <- as.data.frame(summary(pref.models[[2]])$coefficients)
 m3 <- as.data.frame(summary(pref.models[[3]])$coefficients)

 makeStatSig <- function(x){
   x <- as.numeric(x)
   y <- rep('***', length(x))
   y[x>.01] <- '** '
   y[x>.05] <- '*  '
   y[x>.1] <- '   '
   y
 }
 m1sig <- makeStatSig(m1[,4])
 m2sig <- makeStatSig(m2[,4])
 m3sig <- makeStatSig(m3[,4])
 
 m1$table.coef <- paste0(ifelse(m1$Estimate>0, ' ', ''), 
                         sprintf('%.3f', round(m1$Estimate,3)),
                         m1sig)
 m2$table.coef <- paste0(ifelse(m2$Estimate>0, ' ', ''),
                         sprintf('%.3f',round(m2$Estimate,3)),
                         m2sig)
 m3$table.coef <- paste0(ifelse(m3$Estimate>0, ' ', ''),
                         sprintf('%.3f',round(m3$Estimate,3)),
                         m3sig)
 
 m1c <- c(m1$table.coef, rep(' ', nrow(m3)-nrow(m1)))
 m2c <- c(m2$table.coef, rep(' ', nrow(m3)-nrow(m2)))
 m3c <- m3$table.coef
 
 full.table <- as.data.frame(cbind(rep('x', length(m1c)), m1c, m2c, m3c))
 names(full.table) <- c('Variable', 'Model 1', "Model 2", "Model 3")
 full.table$Variable <- c('Intercept', 'House (Type)', '2 Bed & 1 Bath',
                          '2 Bed & 2 Bath', '3 Bed & 1 Bath', '3 Bed & 2 Bath',
                          '4 Bed & 2 Bath', 'City (Submarket)',
                          'Suburban (Submarket)', 'Rural (Submarket)', 
                          'Beach (Submarket)', 'Guests per Bedroom', 
                          'Minimum Stay', 'Flexible Cancel', 'Strict Cancel')
 
 ## Create model diagnostics  
  
  # Custom function
  logDx <- function(log.model, data, resp.var){
    
    pred <- prediction(predict(log.model, data, type='response'), resp.var)
    auc <- performance(pred, measure='auc')
    ll <- logLik(log.model)
    AIC <- AIC(log.model)
    
    return(list(AIC=AIC,
                logLik=ll,
                auc=auc))
  }
  
  # Extract diagnostics
  str.dx <- logDx(pref.models[[1]], str.data.ic, str.data.ic$str.ext.pref)
  sm.dx <- logDx(pref.models[[2]], str.data.ic, str.data.ic$str.ext.pref)
  host.dx <- logDx(pref.models[[3]], str.data.ic, str.data.ic$str.ext.pref)
  
  # Create diagnostic table
  diag.table <- data.frame(Variable=c('', 'Diagnostics', 'AIC', 'LogLik',
                                      'AUC'),
                           Str.Model=c('', '', round(str.dx$AIC,0), 
                                       round(str.dx$logLik, 0),
                                       round(as.numeric(str.dx$auc@y.values),
                                             3)),
                           Sm.Model=c('', '', round(sm.dx$AIC,0), 
                                      round(sm.dx$logLik, 0),
                                      round(as.numeric(sm.dx$auc@y.values), 3)),
                           Host.Model=c('', '', round(host.dx$AIC,0), 
                                        round(host.dx$logLik, 0),
                                        round(as.numeric(host.dx$auc@y.values),
                                              3)))
  names(diag.table) <- c('Variable', 'Model 1', "Model 2", "Model 3")
  
 ## Combine into full table of coef and diags
  #full.table[,2] <- gsub(" ", "&nbsp;", full.table[,2], fixed=TRUE)
  
 full.table <- rbind(full.table, diag.table)
 
 x.full <- xtable(full.table,
                  caption='Logistic Modeling Results\n')
 align(x.full) <- 'lllll'

 print(x.full,
       include.rownames=FALSE,
       hline.after=c(-1,0,15,20,20),
       caption.placement='top')

```

&nbsp;

### Sensitivity Tests

#### Potential Revenue 

Look at difference if using potential revenue

-- Show differences in global numbers and heat maps
-- Re-do the logistic models with potential revenue

```{r, results='asis', echo=FALSE, message=FALSE, comment=FALSE, fig.cap='Logistic Model Results of Short Term Preference', fig.lp='xxx'}

 pm1 <- as.data.frame(summary(pref.models[[4]])$coefficients)
 pm2 <- as.data.frame(summary(pref.models[[5]])$coefficients)
 pm3 <- as.data.frame(summary(pref.models[[6]])$coefficients)

 pm1sig <- makeStatSig(pm1[,4])
 pm2sig <- makeStatSig(pm2[,4])
 pm3sig <- makeStatSig(pm3[,4])
 
 pm1$table.coef <- paste0(ifelse(pm1$Estimate>0, ' ', ''), 
                         sprintf('%.3f', round(pm1$Estimate,3)),
                         pm1sig)
 pm2$table.coef <- paste0(ifelse(pm2$Estimate>0, ' ', ''),
                         sprintf('%.3f',round(pm2$Estimate,3)),
                         pm2sig)
 pm3$table.coef <- paste0(ifelse(pm3$Estimate>0, ' ', ''),
                         sprintf('%.3f',round(pm3$Estimate,3)),
                         pm3sig)
 
 pm1c <- c(pm1$table.coef, rep(' ', nrow(pm3)-nrow(pm1)))
 pm2c <- c(pm2$table.coef, rep(' ', nrow(pm3)-nrow(pm2)))
 pm3c <- pm3$table.coef
 
 pfull.table <- as.data.frame(cbind(rep('x', length(pm1c)), pm1c, pm2c, pm3c))
 names(pfull.table) <- c('Variable', 'Model 1', "Model 2", "Model 3")
 pfull.table$Variable <- c('Intercept', 'House (Type)', '2 Bed & 1 Bath',
                          '2 Bed & 2 Bath', '3 Bed & 1 Bath', '3 Bed & 2 Bath',
                          '4 Bed & 2 Bath', 'City (Submarket)',
                          'Suburban (Submarket)', 'Rural (Submarket)', 
                          'Beach (Submarket)', 'Guests per Bedroom', 
                          'Minimum Stay', 'Flexible Cancel', 'Strict Cancel')
 
 ## Create model diagnostics  
  
  # Extract diagnostics
  pstr.dx <- logDx(pref.models[[4]], str.data.ic, str.data.ic$str.pot.pref)
  psm.dx <- logDx(pref.models[[5]], str.data.ic, str.data.ic$str.pot.pref)
  phost.dx <- logDx(pref.models[[6]], str.data.ic, str.data.ic$str.pot.pref)
  
  # Create diagnostic table
  pdiag.table <- data.frame(Variable=c('', 'Diagnostics', 'AIC', 'LogLik',
                                      'AUC'),
                           Str.Model=c('', '', round(pstr.dx$AIC,0), 
                                       round(pstr.dx$logLik, 0),
                                       round(as.numeric(pstr.dx$auc@y.values),
                                             3)),
                           Sm.Model=c('', '', round(psm.dx$AIC,0), 
                                      round(psm.dx$logLik, 0),
                                      round(as.numeric(psm.dx$auc@y.values),
                                            3)),
                           Host.Model=c('', '', round(phost.dx$AIC,0), 
                                        round(phost.dx$logLik, 0),
                                        round(as.numeric(phost.dx$auc@y.values),
                                              3)))
  names(pdiag.table) <- c('Variable', 'Model 1', "Model 2", "Model 3")
  
 ## Combine into full table of coef and diags
  #full.table[,2] <- gsub(" ", "&nbsp;", full.table[,2], fixed=TRUE)
  
 pfull.table <- rbind(pfull.table, pdiag.table)
 
 px.full <- xtable(pfull.table,
                   caption='Logistic Modeling Results\n')
 align(px.full) <- 'lllll'

 print(px.full,
       include.rownames=FALSE,
       hline.after=c(-1, 0, 15, 20, 20),
       caption.placement='top')

```

#### Host Classification

Look at difference if breaking down by host type
-- Show new numbers and heat maps
-- Re-do logistic models, extrapolate but divided by hosts

Note that ability to examine different facets of the data is coming to an interactive website soon.

\pagebreak

<!-- ## Discussion -->

<!-- <!-- Although it gathers considerable interest in both economic and public policy circles, analyses of Airbnb market and their comparison to more traditional long-term leasing strategies remains relatively unaddressed.  This work attempts to fill this void.  --> 

<!-- The Airbnb market is Melbourne is rapidly expanding, as total listings on the portal have jumped from around 7,000 in 2014 to more than 20,000 in August 2016.  However, of this total, only 6,600 or so of the properties are entire homes or apartments that were listed as available for at least one day during the September 1, 2015 to August 31, 2016 time frame.  Of these, only 4,400 are common bed/bath configurations with non-outlying rates and were booked for at least one night over the period of study. Overall, the Airbnb market is very small relative to the long-term market. We caution future researchers and policy analysts to look deeply at initial estimates of Airbnb counts as many of the listings on the market are either room shares and/or not active.     -->

<!-- Comparing annual revenues from the two leasing strategies shows that revenues from more traditional long-term rentals are, on average, higher and much less variable than those from the Airbnb market (Figure 10).  However, there is long right tail to the distibution of short-term revenues suggesting that some owners are doing better, and occasionally much better, on Airbnb than they would on the long-term market. This univariate comparison of revenues does not tell the entire story, as the Airbnb market does not have the same spatial distribution as the long-term market (Figure 8).  Short-term leasing is much more common in the central areas of the city, with small clusters showing up in suburban beach locations and rural tourist destinations like the Yarra Valley wine district.  -->

<!-- To control for these differences, we set out to make direct comparison of short and long term revenues on both the short and long term market observations. The shared information that is available on both sets of properties is limited. Our initial work found estimating long term rental values and tenant search times for the short term properties to be feasible with these data constraints while the opposite is much more difficult. In other words, there appear to by many unobserved variables (presense of wi-fi, parking and laundry facilities) and/or none-property specific characteristics (such as minimum stays, pet policies, number of allowed guests, cancellation policies) that influence short term nightly rates and occupancy rates.  As a result, we were not able to accurately estimate likely short-term rates for the long-term observations.   -->

<!-- In looking only at the short-term observation with estimated long-term rents we found that approximately one in three Airbnb properties brought in more revenue with its short term strategy than it would have with a long-term approach. As expected, this probability is not equal across space, property type or property size (bed and bath count).  Apartments are much more likely than houses to be more profitable as a short term rental.  Core city properties are more likely than other properties to prefer a short-term strategy, as are larger properties versus smaller ones.  For instance, 45\% of apartments in the city core generated more revenue on Airbnb than they likely would have on the long term market.  Examining only apartments with at least three bedrooms and two baths that figure increases to 60\%. -->

<!-- The nightly rates and total occupancies drive the profitability of short-term leasing.  As the nightly rate vs. occupancy rate heat maps and SVM plots (Figures 16, 17, 18 and 19) show, even with very high nightly rates, owners would need to achieve an occupancy rate of at least the median in market (around 40\%) in order to achieve a better than 50\% probability of being more profitable in a short-term strategy than a long term one. A 40\% occupancy rate means bookings at least three days out of every week all year long. In Melbourne summers this may be an easy feat as tourist numbers swell, but doing so on a cold week in July likely proves more difficult.    -->

<!-- The logistic regression models than we estimate show that most of the finding from the univariate and bivariate analyses done earlier are validated (Table 7).  Large apartments in the central city are the best bet for generating greater revenues through short term leasing.  We also test for the impact of host behavior on the probability of short term preference.  We find that more flexibility around the number of guests and the minimum stay increase the probability of short-term preference, while the reverse is true of cancellation policies (more strict equals higher short term preference probability).  As a host, it appears to be best to do what you can to attract bookings and then make it difficult for those bookings to be cancelled.     -->

<!-- ### Limitations and Future Research -->

<!-- There are a number of limitations to this research.  There are few shared property characterstics between the two datasets, which make cross-estimating rents and rates difficult, especially from the short-term market.  Part of the difficulty in estimating potential short-term rates for long-term properties is that the short term market appears to be heavily influenced by non-property specific factors such as the leasing policies (minimum stay, number of guests, etc.) themselves.  Future research should focus both on building better models to explain (and ultimately predict) short term rates and occupancies as well as to understand the impact of policies such as strict cancellation or no pets on the short term market.  It is likely that this work is being done proprietarily by Airbnb.com itself and other complementary firms such as AirDNA.com, our data provider.   -->

<!-- Additionally, we have opted to make comparisons between short and long-term strategies by cross estimating likely rates and rents.  Alternatively, a matching procedure could be employed that would match like properties between the two markets and use comparisons between the two as evidence of potential short and long-term revenues.   -->

<!-- In this work, we have made the assumption that, over the course of a year, the general maintenance costs (excluding basic janitorial) are identical between short and long-term leasing options.  We have done so as we were unable to location any evidence to suggest that one was higher than the other.  This may be a limitation of our study and could prove to be an avenue of future research.   -->

<!-- Beyond airBNB.com other short-term platforms exist (e.g. www.homeaway.com). This project doesn't take into account that individual properties may be advertised and rented out through different platforms. These are additional revenue streams that are not take into account and might increase the occupancy and revenue for short-term rentals. -->

<!-- Finally, our analysis looks at a single year, beginning in September (spring) and ending in August in which the property owner is given a binary option of either short or long term leasing strategy.  In reality, the possibilities may not be so rigid.  For example,given the fact that Melbourne's large university student population (many of whom are international) require housing during Autumn, Winter and Spring, while tourist swell in the summer months, an enterprising owner maybe able to pair long term leasing during the off-season with short-term leasing during peak times to maximize revenues.  In general, the rise of Airbnb and related portals give properties owners more options, and therefore more opportunities, to maximize returns on their property.  Future research should expand our scenario to look at more than just a single binary option over a fixed period.  We feel there may be significant opportunities for new ventures in industry to exploit the changing market for housing.    -->

\pagebreak

## References


<!-- Heat map with other characteristics on axis

<!-- ### Submarkets -->

<!-- ### Flexible Geo Analysis -->

<!-- ### Logit Models (maybe?) -->

<!-- ### Reference to Shiny App -->

<!-- ## Future Research -->

<!-- - Does time of purchase (which month) matter? -->
